# vag-force333 — microservices demo

Короткое руководство по запуску проекта локально и в CI.

Требования
- Docker & Docker Compose (для поднятия сервисов)
- Python 3.11/3.12 (локальный venv optional)

Запуск локально (рекомендуется для разработки):

1) Создайте виртуальное окружение (опционально) и установите зависимости:

```powershell
python -m venv .venv
& .\.venv\Scripts\Activate.ps1
python -m pip install -r requirements.txt
```

2) Поднять сервисы через docker-compose:

```powershell
docker compose up -d --build
```

Ожидаемые адреса сервисов (по умолчанию в `docker-compose.yml`):
- frontend: http://localhost:8000
- auth: http://localhost:8001
- payments: http://localhost:8005
- orders: http://localhost:8004
- inventory: http://localhost:8008

3) Опционально — создать demo-пользователя и проверить инвентарь:

```powershell
python .\scripts\seed_demo.py
```

4) Запуск интеграционных тестов (локально, с поднятыми сервисами):

```powershell
.venv\Scripts\python.exe -m pytest -q
```

Полезные тестовые endpoints
- `POST /api/inventory/reset` — установить словарь количеств (тестовый endpoint, по умолчанию доступен локально)
- `POST /api/inventory/release` — вернуть зарезервированные единицы
- `POST /api/payments/charge` — если в поле `payment_method` указано `"fail"`, сервис симулирует сбой платежа (используется в тестах)

CI
- В репозитории есть базовый GitHub Actions workflow `.github/workflows/ci.yml` (если включить), который поднимает контейнеры и запускает тесты.

Если нужно, добавлю инструкции по деплою/дальнейшей автоматизации.


5) Ниже — простой и понятный список реализованных микросервисов в проекте и что каждый делает. Всё на русском и без лишней воды.

Frontend / Web UI (в папке app)
Что делает: рендерит HTML-страницы (Jinja2), обслуживает статические файлы (CSS/JS), реализует страницы: каталог, корзина, checkout, профиль, авторизация.
Ключевые части: main.py, pages.py, шаблоны в templates, фронтенд-скрипты в js.
Ответственность: пользовательский интерфейс, сессии, хранение токена в localStorage/cookie, отправка запросов на API (заказы, авторизация).
Технологии: FastAPI (шаблоны), Jinja2, vanilla JS.

Orders Service (orders-service)
Что делает: принимает заказ (checkout), сохраняет заказ в базу, отдаёт историю/детали заказов пользователя.
Ключевые эндпоинты:
POST /api/orders/checkout — принять заказ, обработать idempotency, записать в таблицу orders.
GET /api/orders/user/{user_id} — вернуть список заказов пользователя.
Важные детали: idempotency (уникальный индекс по idempotency_key), поля заказа (amount, currency, created_at и т.д.), CORS настроен, интеграция/запросы к mock-платежам и инвентарю.
Технологии: FastAPI, SQLAlchemy (async), asyncpg, Alembic (миграции).


Payments Service (mock)
Что делает: имитирует процесс оплаты — принимается запрос на оплату, возвращается успех/ошибка.
Почему нужен: для интеграции checkout (чтобы не подключать реальный платежный шлюз).
Замечание: обычно простой HTTP mock, иногда используемый в тестах/локальном демо.

Inventory Service (mock)
Что делает: резервирует/проверяет остатки товаров при оформлении заказа (запросы от orders-service).
Почему нужен: чтобы эмулировать блокировку товара и инвентарную логику при checkout.
Замечание: может возвращать ошибки для тестирования отката/обработки ошибок.


DB / Seeder job (db-seed)
Что делает: разовый job для заполнения БД демо-данными — создает тестовых пользователей и фиксированный каталог (10 VAG-запчастей).
Где: обычно описан в db_seed.py и запускается через docker-compose как одноразовый контейнер (db-seed).
Роль: подготовка данных для демонстрации (чтобы не создавать товары вручную).
(Опционально) Auth API
Что делает: аутентификация и выдача токенов / эндпоинт GET /api/auth/me.
Где реализовано: часть frontend-сервиса (auth.py) или как отдельный сервис в зависимости от арх-выбора.
Ответственность: логин/регистрация, выдача vf_token.