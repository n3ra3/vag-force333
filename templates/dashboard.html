<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Панель — VAG FORCE</title>
  <style>
    body{ font-family: Inter, system-ui, Arial; margin:0; min-height:100vh; background:linear-gradient(135deg,#f8fafc,#e6eef8); color:#0f172a; }
    header{ padding:18px 24px; display:flex; justify-content:space-between; align-items:center; }
    .container{ max-width:980px; margin:24px auto; padding:20px; background:white; border-radius:12px; box-shadow:0 10px 30px rgba(2,6,23,0.06); }
    button{ background:#2563eb;color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer }
  </style>
</head>
<body>
  <header>
    <div style="font-weight:700">VAG FORCE — Панель</div>
    <div>
      <button id="logout">Выйти</button>
    </div>
  </header>
  <main class="container">
    <h2>Добро пожаловать в панель</h2>
    <p id="who">Загрузка профиля...</p>
  </main>

  <script>
    const token = localStorage.getItem('vf_token');
    const who = document.getElementById('who');
    const logoutBtn = document.getElementById('logout');
    if(!token){
      location.href = '/login';
    } else {
      fetch('/api/auth/me', { headers: { Authorization: 'Bearer ' + token } })
        .then(r=> r.ok ? r.json() : Promise.reject(r))
        .then(user=> {
          who.textContent = `Вы вошли как ${user.full_name} (${user.email})`;
        })
        .catch(async err=>{
          try{ const e = await err.json(); who.textContent = 'Ошибка: ' + (e.detail || JSON.stringify(e)); }catch(e){ who.textContent = 'Ошибка получения профиля'; }
        });
    }

    logoutBtn.addEventListener('click', ()=>{
      localStorage.removeItem('vf_token');
      location.href = '/login';
    });
  </script>
</body>
</html>
